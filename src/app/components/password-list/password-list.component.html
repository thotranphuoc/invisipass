<div class="list-container">
  <div class="top-bar">
    <div class="search-box glass">
      <input [formControl]="searchControl" placeholder="Search labels or apps..." />
    </div>
    <div class="vault-status" [class.unlocked]="!isLocked()">
      {{ isLocked() ? 'Vault Locked' : 'Vault Active' }}
    </div>
  </div>

  <div class="accordion-list">
    @for (acc of accounts(); track acc.id) {
      <div class="acc-card glass" 
           [class.expanded]="expandedId() === acc.id"
           [class.editing]="editingId() === acc.id"
           (click)="toggleCard(acc.id!)">
        
        <div class="acc-header">
          <div class="header-info">
            <div class="avatar">{{ acc.label[0] | uppercase }}</div>
            <div class="titles">
              <h3>{{ acc.label }}</h3>
              <p>{{ acc.appPath }}</p>
            </div>
          </div>
          <div class="chevron"></div>
        </div>

        <div class="acc-content">
          <div class="divider"></div>

          @if (editingId() === acc.id) {
            <form [formGroup]="editForm" class="edit-form">
              <div class="edit-grid">
                <div class="field-group"><label>Label</label><input formControlName="label" /></div>
                <div class="field-group"><label>App Path</label><input formControlName="appPath" /></div>
                <div class="field-group"><label>Username</label><input formControlName="username" /></div>
                <div class="field-group"><label>Password</label><input formControlName="password" /></div>
              </div>
              <div class="edit-actions">
                <button type="button" (click)="cancelEdit($event)" class="btn-cancel">Cancel</button>
                <button type="button" (click)="saveUpdate($event, acc.id!)" class="btn-save">Save</button>
              </div>
            </form>
          } @else {
            <div class="view-grid">
              <div class="data-item">
                <label>Username</label>
                <div class="copy-box">
                  <code>{{ decrypt(acc.username) }}</code>
                  <button (click)="copy($event, decrypt(acc.username))">Copy</button>
                </div>
              </div>
              <div class="data-item">
                <label>Password</label>
                <div class="copy-box">
                  <code>{{ decrypt(acc.password) }}</code>
                  <button (click)="copy($event, decrypt(acc.password))">Copy</button>
                </div>
              </div>
            </div>
            <div class="footer-actions">
              <button class="edit-btn" (click)="startEdit($event, acc)">Edit</button>
              <button class="delete-btn" (click)="deleteAccount($event, acc.id)">Delete</button>
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>

<app-passcode-dialog *ngIf="showPasscodeModal" (close)="showPasscodeModal = false"></app-passcode-dialog>